# Playwright HTML Report Button Integration

## Summary

Fixed the "View Full Playwright Report" button in the TestBot dashboard to properly link to and display the full Playwright HTML report.

## Changes Made

### 1. Playwright Configuration (`examples/sample-project/playwright.config.js`)

**Added HTML reporter:**

```javascript
reporter: [
  ['list'],  // Console output
  ['json', { outputFile: 'test-results.json' }],  // For TestBot dashboard integration
  ['html', { outputFolder: 'playwright-report', open: 'never' }],  // HTML report for detailed view
],
```

**What this does:**
- Generates a full interactive HTML report at `playwright-report/index.html`
- Includes integrated trace viewer, video player, and screenshot gallery
- Report contains test timeline, network logs, console output, and more
- `open: 'never'` prevents auto-opening in browser after tests

### 2. Report Generator (`testbot-mcp/src/report-generator.js`)

**Added two new methods:**

#### `copyPlaywrightHTMLReport(projectPath, reportsDir)`
- Searches for Playwright HTML report in common locations:
  - `projectPath/playwright-report`
  - `projectPath/examples/sample-project/playwright-report`
  - `projectPath/sample-project/playwright-report`
- Copies entire report directory to `testbot-reports/playwright-report/`
- Makes report accessible from TestBot dashboard
- Handles errors gracefully if report doesn't exist

#### `copyDirectoryRecursive(source, dest)`
- Recursively copies directory and all subdirectories
- Preserves file structure and permissions
- Used by `copyPlaywrightHTMLReport()` to copy the entire report

**Integration:**
- Called automatically in the `generate()` method after copying artifacts
- Runs every time a test report is generated

### 3. Dashboard HTML (`dashboard/public/index.html`)

**Updated button link:**

```html
<a href="../../testbot-reports/playwright-report/index.html" 
   class="footer-link" 
   target="_blank" 
   id="playwrightReportLink">
    <i class="fas fa-file-alt"></i> View Full Playwright Report
</a>
```

**Path explanation:**
- Dashboard is at: `dashboard/public/index.html`
- Report is at: `testbot-reports/playwright-report/index.html`
- Relative path: `../../testbot-reports/playwright-report/index.html`

**Added JavaScript to check report availability:**

```javascript
function checkPlaywrightReport() {
    const link = document.getElementById('playwrightReportLink');
    if (!link) return;
    
    // Try to fetch the report to see if it exists
    fetch('../../testbot-reports/playwright-report/index.html', { method: 'HEAD' })
        .then(response => {
            if (!response.ok) {
                // Report doesn't exist, disable the link
                link.style.opacity = '0.5';
                link.style.cursor = 'not-allowed';
                link.title = 'Playwright HTML report not yet generated. Run tests to generate it.';
                link.onclick = function(e) {
                    e.preventDefault();
                    alert('Playwright HTML report not yet generated. Run tests with the HTML reporter enabled to generate it.');
                    return false;
                };
            } else {
                link.title = 'Open full Playwright HTML report in a new tab';
            }
        })
        .catch(() => {
            // Fetch failed, likely file:// protocol or report doesn't exist
            link.title = 'Click to view full Playwright HTML report';
        });
}

// Check report availability after page loads
setTimeout(checkPlaywrightReport, 500);
```

**What this does:**
- Checks if the report exists when dashboard loads
- If report doesn't exist: dims button, shows helpful message, prevents navigation
- If report exists: enables button, opens in new tab when clicked
- Gracefully handles both web server and file:// protocol scenarios

## How It Works

### Test Execution Flow

```
1. User runs tests via TestBot
   ↓
2. Playwright executes tests with HTML reporter enabled
   ↓
3. HTML report generated at: playwright-report/index.html
   ↓
4. TestBot generates JSON report for dashboard
   ↓
5. ReportGenerator.copyPlaywrightHTMLReport() runs
   ↓
6. HTML report copied to: testbot-reports/playwright-report/
   ↓
7. Dashboard button now links to accessible report
```

### File Structure

```
QA_Final/
├── examples/sample-project/
│   ├── playwright-report/           # Original location (generated by Playwright)
│   │   ├── index.html
│   │   ├── data/
│   │   └── assets/
│   └── playwright.config.js         # ✓ HTML reporter enabled
│
├── testbot-reports/
│   ├── playwright-report/           # Copied location (accessible from dashboard)
│   │   ├── index.html
│   │   ├── data/
│   │   └── assets/
│   ├── latest.json
│   └── artifacts/
│
└── dashboard/
    ├── public/
    │   └── index.html               # ✓ Button points to ../../testbot-reports/playwright-report/
    └── src/
        └── reporter.js
```

## Features of Playwright HTML Report

When users click "View Full Playwright Report", they get:

### 1. **Test List & Filtering**
- All tests with status (passed/failed/skipped)
- Filter by status, project, file
- Search tests by name
- Sort by duration, status, etc.

### 2. **Integrated Trace Viewer**
- Click any test to see its trace inline
- Step-by-step action timeline
- DOM snapshots at each step
- Network requests and responses
- Console logs and errors
- Screenshots at each action

### 3. **Video Playback**
- Watch test execution as video
- Synchronized with action timeline
- Slow-motion playback
- Pause/resume controls

### 4. **Screenshot Gallery**
- All screenshots organized by test
- Before/after comparison
- Full-page captures
- Element-level captures

### 5. **Test Metadata**
- Duration and timing
- Browser and device info
- Retry information
- Tags and annotations

### 6. **Network Analysis**
- All HTTP requests
- Request/response headers
- Payload inspection
- Status codes and timing

## Testing the Integration

### Manual Testing Steps

1. **Run tests:**
   ```bash
   cd examples/sample-project
   npm test
   ```

2. **Verify HTML report generated:**
   ```bash
   ls playwright-report/index.html
   # Should exist
   ```

3. **Generate TestBot report:**
   ```bash
   # Run TestBot's test-my-app command
   # Or trigger test execution through MCP
   ```

4. **Verify report copied:**
   ```bash
   ls ../../testbot-reports/playwright-report/index.html
   # Should exist
   ```

5. **Open dashboard:**
   ```bash
   open dashboard/public/index.html
   ```

6. **Click "View Full Playwright Report" button:**
   - Should open in new tab
   - Should show Playwright's interactive HTML report
   - Should have all tests with traces/videos/screenshots

### Expected Behavior

**When report exists:**
- Button is fully visible and clickable
- Clicking opens report in new tab
- Hover shows: "Open full Playwright HTML report in a new tab"

**When report doesn't exist:**
- Button is dimmed (50% opacity)
- Cursor shows "not-allowed"
- Clicking shows alert: "Playwright HTML report not yet generated..."
- Hover shows: "Playwright HTML report not yet generated. Run tests to generate it."

## Troubleshooting

### Button doesn't work

**Symptom:** Button is dimmed or shows error message

**Causes & Solutions:**

1. **Report not generated yet**
   - Run tests first: `cd examples/sample-project && npm test`
   - Check playwright.config.js has HTML reporter
   - Verify `playwright-report/` directory exists

2. **Report not copied**
   - Check TestBot report was generated
   - Look for log: `[Report] Copied Playwright HTML report from...`
   - Verify `testbot-reports/playwright-report/` exists

3. **Wrong path**
   - Dashboard link: `../../testbot-reports/playwright-report/index.html`
   - Verify relative path is correct from `dashboard/public/`
   - Check both directories exist

### Report opens but is empty

**Symptom:** HTML report opens but shows no tests

**Causes & Solutions:**

1. **Tests didn't run**
   - Check `playwright-report/` has test data
   - Look for `data/*.json` files in report directory

2. **Incomplete copy**
   - Report directory should have:
     - `index.html`
     - `data/` folder with test results
     - `assets/` folder with styles/scripts
   - Re-run tests to regenerate complete report

### Can't open report (file:// protocol)

**Symptom:** Browser blocks opening file

**Solutions:**

1. **Use local web server:**
   ```bash
   cd testbot-reports/playwright-report
   python3 -m http.server 8080
   # Open: http://localhost:8080
   ```

2. **Use Playwright's built-in server:**
   ```bash
   npx playwright show-report testbot-reports/playwright-report
   ```

## Benefits

1. **Comprehensive Debugging**
   - Full trace viewer with DOM snapshots
   - Video playback of test execution
   - Network logs and console output

2. **Better Test Analysis**
   - Test timeline shows execution order
   - Identify slow tests
   - Find flaky tests with retry info

3. **Team Collaboration**
   - Share detailed reports with team
   - Non-technical stakeholders can view test results
   - Rich visualization of test coverage

4. **Integrated Workflow**
   - Single click from TestBot dashboard
   - No need to remember report locations
   - Automatic report generation and copying

## Related Documentation

- `PLAYWRIGHT_MCP_GUIDE.md` - Complete Playwright MCP integration guide
- `dev_documentation.txt` - Technical implementation details
- `DASHBOARD_REFRESH_GUIDE.md` - Dashboard usage guide
- Playwright docs: https://playwright.dev/docs/test-reporters#html-reporter
